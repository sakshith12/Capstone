{% extends "base.html" %}

{% block title %}Download File - Secure File Transfer{% endblock %}

{% block content %}
<div class="card">
    <h2>Download Secure File</h2>
    <form method="post">
        <div class="form-group">
            <label for="access_code">Access Code:</label>
            <input type="text" id="access_code" name="access_code" required 
                   placeholder="Enter 6-digit access code" maxlength="6"
                   pattern="[A-Z0-9]{6}">
        </div>
        
        <div class="form-group">
            <label for="decryption_key">Decryption Key:</label>
            <input type="text" id="decryption_key" name="decryption_key" required
                   placeholder="Enter 6-digit decryption key" maxlength="6"
                   pattern="[A-Z0-9]{6}">
        </div>
        
        <button type="submit">Decrypt & Download File</button>
    </form>
</div>

<div class="card">
    <h3>Your Shared Files</h3>
    {% if shared_files %}
    <div class="file-list">
        {% for file in shared_files %}
        <div class="file-item">
            <div class="file-info">
                <div>
                    <strong>{{ file_data[file.file_code].filename if file.file_code in file_data else 'File' }}</strong><br>
                    <small>From: {{ file.sender }}</small><br>
                    <small>Access Code: <code style="background: #f0f0f0; padding: 2px 5px; border-radius: 3px;">{{ file.access_code }}</code></small><br>
                    <small>Decryption Key: <code style="background: #f0f0f0; padding: 2px 5px; border-radius: 3px;">{{ file.decryption_key }}</code></small>
                </div>
                <div class="file-actions">
                    <form method="post" action="{{ url_for('download_file') }}" style="display: inline;">
                        <input type="hidden" name="access_code" value="{{ file.access_code }}">
                        <input type="hidden" name="decryption_key" value="{{ file.decryption_key }}">
                        <button type="submit">Download</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No files available for download.</p>
    {% endif %}
</div>
{% endblock %}